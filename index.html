<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8">
<title>Seasoning Coverage Checker</title>
<meta name="viewport" content="width=device-width, initial-scale=1">

<style>
body { margin:0; padding:16px; font-family:Arial; text-align:center; background:#fff; }
h1 { margin-bottom:12px; font-size:20px; }

#container { position:relative; width:92vw; max-width:420px; aspect-ratio:1/1; margin:auto;
             background:#000; border-radius:12px; overflow:hidden; }

video, #uploadedImg { width:100%; height:100%; object-fit:cover; display:block; }
canvas { position:absolute; top:0; left:0; width:100%; height:100%; pointer-events:none; }

.controls { margin-top:14px; display:flex; gap:10px; justify-content:center; flex-wrap:wrap; }
button, label { background:#ff6a00; border:none; padding:10px 16px; color:white;
                border-radius:8px; cursor:pointer; font-weight:bold; }
label { background:#444; }

#coverage { margin-top:14px; font-size:18px; font-weight:bold; }
#uploadedImg { display:none; }
</style>
</head>

<body>

<h1>Seasoning Coverage Checker</h1>

<div id="container">
  <video id="video" autoplay playsinline muted></video>
  <img id="uploadedImg">
  <canvas id="overlayCanvas"></canvas>
</div>

<div class="controls">
  <button id="captureBtn">Capture & Analyze</button>
  <label>Upload Image<input type="file" id="fileInput" accept="image/*" style="display:none"></label>
</div>

<div id="coverage">Coverage: —</div>

<canvas id="processCanvas" style="display:none"></canvas>

<script>
const video = document.getElementById("video");
const uploadedImg = document.getElementById("uploadedImg");
const overlayCanvas = document.getElementById("overlayCanvas");
const processCanvas = document.getElementById("processCanvas");

// Start camera
navigator.mediaDevices.getUserMedia({ video:{ facingMode:"environment" } })
.then(s => video.srcObject = s)
.catch(() => coverage.textContent = "⚠ Allow camera permission.");

// Seasoning detection function
function isSeasoned(r,g,b){
  return (r > 120 && r > g + 15 && r > b + 15) ||
         ((r+g > 210) && (r/g < 2.2) && (r/b > 1.2));
}

// Unseasoned (white)
function isUnseasoned(r,g,b){
  let avg = (r+g+b)/3;
  return avg > 160 && (Math.max(r,g,b) - Math.min(r,g,b) < 25);
}

function analyze(source){
  const p = processCanvas, ctx = p.getContext("2d");
  p.width = source.videoWidth || source.width;
  p.height = source.videoHeight || source.height;

  ctx.drawImage(source,0,0,p.width,p.height);
  const img = ctx.getImageData(0,0,p.width,p.height);
  let d = img.data;

  let total=0, seasoned=0;

  const o = overlayCanvas, octx = o.getContext("2d");
  o.width=p.width; o.height=p.height;
  octx.clearRect(0,0,o.width,o.height);

  for(let i=0;i<d.length;i+=4){
    let r=d[i], g=d[i+1], b=d[i+2];
    let x = (i/4) % p.width;
    let y = Math.floor((i/4) / p.width);

    if(isSeasoned(r,g,b)){
      seasoned++; total++;
      octx.fillStyle="rgba(255,0,0,0.55)";
      octx.fillRect(x,y,1,1);
    }
    else if(isUnseasoned(r,g,b)){
      total++;
      octx.fillStyle="rgba(0,120,255,0.55)";
      octx.fillRect(x,y,1,1);
    }
  }

  let pct = total ? (seasoned/total)*100 : 0;
  coverage.textContent = "Coverage: " + pct.toFixed(1) + "%";
}

// Capture button
captureBtn.onclick = () => {
  uploadedImg.style.display="none";
  video.style.display="block";
  analyze(video);
};

// Upload image
fileInput.onchange = e => {
  const fileURL = URL.createObjectURL(e.target.files[0]);
  uploadedImg.src = fileURL;
  uploadedImg.onload = () => {
    video.style.display="none";
    uploadedImg.style.display="block";
    analyze(uploadedImg);
  };
};
</script>
</body>
</html>
