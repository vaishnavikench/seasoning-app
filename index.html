<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8">
<title>Seasoning Coverage Checker</title>
<meta name="viewport" content="width=device-width, initial-scale=1">
<style>
body{margin:0;font-family:Arial,Helvetica,sans-serif;display:flex;flex-direction:column;align-items:center;padding:16px;background:#fff}
h1{font-size:20px;margin-bottom:12px}
.cameraBox{position:relative;width:92vw;max-width:420px;aspect-ratio:1/1.2;background:#000;border-radius:12px;overflow:hidden}
video, img{width:100%;height:100%;object-fit:cover;display:block}
.controls{margin-top:12px;display:flex;gap:8px;flex-wrap:wrap;justify-content:center}
button{background:#ff6a00;color:#fff;padding:10px 16px;border:none;border-radius:8px;font-weight:bold}
#coverage{margin-top:14px;font-size:18px;font-weight:600}
#overlayCanvas{position:absolute;top:0;left:0;width:100%;height:100%;pointer-events:none}
</style>
</head>
<body>

<h1>Seasoning Coverage Checker</h1>

<div class="cameraBox">
  <video id="video" autoplay playsinline muted></video>
  <canvas id="overlayCanvas"></canvas>
</div>

<div class="controls">
  <button id="captureBtn">Capture & Analyze</button>
  <label style="background:#ddd;color:#000;padding:10px 16px;border-radius:8px;">
    Upload Image
    <input type="file" id="fileInput" accept="image/*" style="display:none;">
  </label>
</div>

<div id="coverage">Coverage: â€”</div>

<canvas id="processCanvas" style="display:none"></canvas>

<script>
// Start camera
(async () => {
  try{
    const stream = await navigator.mediaDevices.getUserMedia({video:{facingMode:"environment"},audio:false});
    video.srcObject = stream;
  }catch(e){
    coverage.textContent = "Allow camera access in browser settings.";
  }
})();

// Color mask: detect orange/red seasoning
function isSeasoned(r,g,b){
  return (r > 150 && g < r*0.85 && b < r*0.65);
}

function analyze(source){
  const canvas = processCanvas;
  const ctx = canvas.getContext("2d");
  canvas.width = source.width;
  canvas.height = source.height;
  ctx.drawImage(source,0,0,canvas.width,canvas.height);

  const img = ctx.getImageData(0,0,canvas.width,canvas.height);
  const d = img.data;

  let product = 0, seasoning = 0;
  for(let i=0;i<d.length;i+=4){
    const r=d[i],g=d[i+1],b=d[i+2];
    // ignore background (very bright / very dark)
    if(r+g+b < 80 || r+g+b > 700) continue;
    product++;
    if(isSeasoned(r,g,b)) seasoning++;
  }

  let pct = product? (seasoning/product)*100 : 0;
  coverage.textContent = `Coverage: ${pct.toFixed(1)}%`;

  // Draw overlay
  const octx = overlayCanvas.getContext("2d");
  overlayCanvas.width = source.width;
  overlayCanvas.height = source.height;
  octx.clearRect(0,0,overlayCanvas.width,overlayCanvas.height);
  octx.fillStyle="rgba(255,0,0,0.5)";

  for(let i=0;i<d.length;i+=4){
    const idx=i/4;
    const x=idx%canvas.width, y=Math.floor(idx/canvas.width);
    const r=d[i],g=d[i+1],b=d[i+2];
    if(isSeasoned(r,g,b)){
      octx.fillRect(x,y,1,1);
    }
  }
}

// Camera capture
captureBtn.onclick = () => analyze(video);

// Upload from gallery
fileInput.onchange = e => {
  const img = new Image();
  img.onload = ()=> analyze(img);
  img.src = URL.createObjectURL(e.target.files[0]);
};
</script>

</body>
</html>
