<!doctype html>
<html>
<head>
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <title>Upload — Seasoning</title>
  <link rel="stylesheet" href="styles.css">
  <script async src="https://docs.opencv.org/4.x/opencv.js"></script>
</head>
<body>
  <div class="container">
    <h2>Upload Image</h2>

    <input type="file" id="fileInput" accept="image/*">
    <div class="imageBox" style="margin-top:12px;">
      <img id="preview" style="display:none; width:100%; height:100%; object-fit:cover;" />
      <canvas id="overlay" class="overlay"></canvas>
    </div>

    <div class="controls">
      <button id="analyzeBtn" class="button">Analyze</button>
      <button class="button" onclick="location.href='index.html'">Back</button>
    </div>

    <div id="result" class="result">Coverage: —</div>
    <div class="small">Upload a clear top-down photo of a single collet.</div>
  </div>

  <script src="analysis.js"></script>
  <script>
    const input = document.getElementById('fileInput');
    const preview = document.getElementById('preview');
    const overlay = document.getElementById('overlay');
    input.onchange = () => {
      const f = input.files[0]; if(!f) return;
      preview.onload = () => {
        // size overlay to natural image pixels
        overlay.width = preview.naturalWidth; overlay.height = preview.naturalHeight;
        overlay.style.width = preview.clientWidth + 'px'; overlay.style.height = preview.clientHeight + 'px';
        preview.style.display = 'block';
        document.getElementById('result').textContent = 'Ready — click Analyze';
      };
      preview.src = URL.createObjectURL(f);
    };

    document.getElementById('analyzeBtn').addEventListener('click', async ()=>{
      if (!preview.src) return alert('Select an image first');
      await analyzeElementAndShow(preview, overlay, document.getElementById('result'));
    });
  </script>
</body>
</html>

